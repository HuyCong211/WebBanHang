@model DoAnChuyenNganh.Models.EF.DonHang
@{
    ViewBag.Title = "Đặt hàng thành công";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" style="margin-top:150px; margin-bottom:100px;">
    <div class="text-center mb-5">
        <h2 class="text-success fw-bold">
            <i class="fas fa-check-circle"></i> Đặt hàng thành công!
        </h2>
        <p class="lead">Cảm ơn bạn đã tin tưởng và mua sắm tại <strong>KRIKSHOP</strong>.</p>
        <p>
            Mã đơn hàng của bạn:
            <strong class="text-primary">@Model.MaDonHang</strong>
        </p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm rounded-4">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(90deg,#28a745,#70e37d);">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Thông tin đơn hàng</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Thông tin đơn -->
                        <div class="col-md-6">
                            <p>
                                <strong>Ngày đặt:</strong> @(Model.NgayTao.HasValue ? Model.NgayTao.Value.ToString("dd/MM/yyyy HH:mm") : "")
                            </p>
                            <p><strong>Tổng tiền:</strong> <span class="text-success">@Model.TongTien.ToString("N0") đ</span></p>
                            <p>
                                <strong>Phương thức thanh toán:</strong>
                                @(Model.PhuongThucThanhToanId == 1 ? "Thanh toán khi nhận hàng (COD)" : "Thanh toán qua VNPay")
                            </p>
                            <p>
                                <strong>Trạng thái:</strong>
                                @switch (Model.TrangThai)
                                {
                                    case 0:
                                        <span class="badge badge-warning">Chờ xác nhận</span>;
                                        break;
                                    case 1:
                                        <span class="badge badge-info">Đã xác nhận</span>;
                                        break;
                                    case 2:
                                        <span class="badge badge-success">Đang giao</span>;
                                        break;
                                    case 3:
                                        <span class="badge badge-success">Hoàn tất</span>;
                                        break;
                                    case 4:
                                        <span class="badge badge-danger">Đã hủy</span>;
                                        break;
                                    default:
                                        <span class="badge badge-secondary">Không xác định</span>;
                                        break;
                                }
                            </p>

                        </div>

                        <div class="col-md-6">
                            <h6><strong>Địa chỉ giao hàng</strong></h6>
                            @if (Model.DiaChiGiaoHang != null)
                            {
                                <p>@Model.DiaChiGiaoHang.HoTen</p>
                                <p>@Model.DiaChiGiaoHang.DienThoai</p>
                                <p>@Model.DiaChiGiaoHang.DiaChiChiTiet</p>
                            }
                            else
                            {
                                <p>Thông tin giao hàng sẽ được cập nhật sau.</p>
                            }
                        </div>



                    </div>

                    <hr />

                    <!-- Chi tiết sản phẩm -->
                    <h5 class="mb-3"><i class="fas fa-box-open me-2"></i> Sản phẩm trong đơn</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle text-center">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Biến thể</th>
                                    <th>Số lượng</th>
                                    <th>Đơn giá</th>
                                    <th>Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    int stt = 1;
                                    foreach (var item in Model.DonHangChiTiets)
                                    {
                                        <tr>
                                            <td>@stt</td>
                                            <td>@(item.BienTheSanPham?.SanPham?.TenSanPham ?? "Không rõ")</td>

                                            <td>
                                                @{
                                                    // Lấy danh sách thuộc tính biến thể (vd: Màu, Size, ...)
                                                    var thuocTinhs = item.BienTheSanPham?.GiaTriThuocTinhs?
                                                        .Select(gt => gt.ThuocTinh.TenThuocTinh + ": " + gt.TenGiaTri)
                                                        .ToList();
                                                }
                                                @if (thuocTinhs != null && thuocTinhs.Any())
                                                {
                                                    @(string.Join(", ", thuocTinhs))

                                                }
                                                else
                                                {
                                                    <span class="text-muted">—</span>
                                                }
                                            </td>
                                            <td>@item.SoLuong</td>
                                            <td>@item.DonGia.ToString("N0") đ</td>
                                            <td>@((item.ThanhTien ?? 0).ToString("N0")) đ</td>
                                        </tr>
                                        ;
                                        stt++;
                                    }
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="text-center mt-4">
                        <a href="@Url.Action("Index", "Home")" class="btn btn-primary rounded-pill px-4 me-2">
                            <i class="fas fa-home"></i> Tiếp tục mua sắm
                        </a>
                        <a href="@Url.Action("DonHangCuaToi", "KhachHang")" class="btn btn-secondary rounded-pill px-4">
                            <i class="fas fa-list"></i> Xem danh sách đơn hàng
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<style>
    .badge {
        font-size: 0.9rem;
        padding: 6px 12px;
        border-radius: 10px;
    }
</style>


